{% extends "base.html" %}

{% block title %}
	Sites &gt; {{site.code}} {{site.name}}
{% endblock %}

{% block style %}
	<style>
		label {
			width: 11em;
			float: left;
		}
	</style>
{% endblock %}

{% block nav %}
	<a href="{{context_path}}/sites">Sites</a> &gt;
	<a href="{{context_path}}/sites/{{site.id}}">{{site.code}} {{site.name}}</a>
 	&gt; Edit
{% endblock %}

{% block content %}
	{% if request.method == "GET" and request.values.delete %}
		<form method="post" action="">
			<fieldset>
				<input type="hidden" name="site_id" value="{{site.id}}">
				<legend>
					Are you sure you want to delete this site and any associated snags?
				</legend>
				<input type="submit" name="delete" value="Delete">
			</fieldset>
		</form>
		<p><a href="">Cancel</a></p>
	{% else %}
		<br>
		<form action="" method="post">
			<fieldset>
				<input type="hidden" name="site_id" value="{{site.id}}">
				<legend>Update this site</legend>
				<label>Name</label>
				{{input_text('site_name', site.name, 40)}}
				<br>
				<label>Code</label>
				{{input_text('code', site.code)}}
				<br>
				<input name="update" type="submit" value="Update">
			</fieldset>
		</form>
		<br>
		<form action="">
			<fieldset>
				<input type="hidden" name="site_id" value="{{site.id}}">
				<legend>Delete this site</legend>
				<input type="submit" name="delete" value="Delete">
			</fieldset>
		</form>
		<br>

		<table>
			<caption>Eras</caption>
			<thead>
				<tr>
					<th>From</th>
					<th>To</th>
					<th>Source</th>
					<th>Supply</th>
					<th>Import MPAN core</th>
					<th>Export MPAN core</th>
				</tr>
			</thead>
			<tbody>
				{% for era in eras %}
					<tr>
						<td>{{era.start_date|hh_format}}</td>
						<td>{{era.finish_date|hh_format}}</td>
						<td>{{era.supply.source.code}}</td>
						<td>{{era.supply.name}}</td>
						<td>
							{% if era.imp_mpan_core %}
								{{era.imp_mpan_core}}
							{% endif %}
						</td>
						<td>
							{% if era.exp_mpan_core %}
								{{era.exp_mpan_core}}
							{% endif %}
						</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
		<br>
		<form action="" method="post">
			<fieldset>
				<input type="hidden" name="site_id" value="{{site.id}}">
				<legend>Insert a supply</legend>
				<br>
				<label>Source</label>
				<select name="source_id">
					{% for source in sources %}
						{{input_option('source_id', source.id, source.code + ' ' + source.name)}}
					{% endfor %}
				</select>
				Generator Type (if source is 'gen' or 'gen-net')
				<select name="generator_type_id">
					{% for generator_type in generator_types %}
						{{input_option('generator_type_id', generator_type.id, generator_type.code + ' ' + generator_type.description)}}
					{% endfor %}
				</select>
				<br>
				<label>Name</label>
				{{input_text('name')}}
				<br>
				<br>
				<fieldset>
					<legend>Start Date</legend>
					{{input_date('start')}}
				</fieldset>
				<br>
				<label>Meter Serial Number</label>
				{{input_text('msn')}}
				<br>
				<label>GSP Group</label>
				<select name="gsp_group_id">
					{% for gsp_group in gsp_groups %}
						{{input_option('gsp_group_id', gsp_group.id, gsp_group.code + ' ' + gsp_group.description)}}
					{% endfor %}
				</select>
				<br>
				<label>MOP Contract</label>
				<select name="mop_contract_id">
					{% for contract in mop_contracts %}
						{{input_option('mop_contract_id', contract.id, contract.name)}}
					{% endfor %}
				</select>
				<br>
				<label>MOP Account</label>
				{{input_text('mop_account')}}
				<br>
				<label>HHDC Contract</label>
				<select name="hhdc_contract_id">
					{% for contract in hhdc_contracts %}
						{{input_option('hhdc_contract_id', contract.id, contract.name)}}
					{% endfor %}
				</select>
				<br>
				<label>HHDC Account</label>
				{{input_text('hhdc_account')}}
				<br>
				<label>Profile Class</label>
				<select name="pc_id">
					{% for pc in pcs %}
						{{input_option('pc_id', pc.id, pc.code + ' ' + pc.name)}}
					{% endfor %}
				</select>
				<br>
				<label>MTC Code</label>
				{{input_text('mtc_code')}}
				<br>
				<label>CoP</label>
				<select name="cop_id">
					{% for cop in cops %}
						{{input_option('cop_id', cop.id, cop.description)}}
					{% endfor %}
				</select>
				<br>
				<label>SSC</label>
				{{input_text('ssc_code')}}
				<br>
				<br>
				<fieldset>
					<legend>Import</legend>
					<label>Mpan Core</label>
					{{input_text('imp_mpan_core', '', 35)}}
					<br>
					<label>LLFC</label>
					{{input_text('imp_llfc_code')}}
					<br>
					<label>Supply Capacity</label>
					{{input_text('imp_sc')}}
					<br>
					<label>Supplier Contract</label>
					<select name="imp_supplier_contract_id">
						{% for contract in supplier_contracts %}
							{{input_option('imp_supplier_contract_id', contract.id, contract.name)}}
						{% endfor %}
					</select>
					<br>
					<label>Supplier Account</label>
					{{input_text('imp_supplier_account')}}
				</fieldset>
				<br>
				<fieldset>
					<legend>Export</legend>
					<label>Mpan Core</label>
					{{input_text('exp_mpan_core', '', 35)}}
					<br>
					<label>LLFC</label>
					{{input_text('exp_llfc_code')}}
					<br>
					<label>Supply Capacity</label>
					{{input_text('exp_sc')}}
					<br>
					<label>Supplier Contract</label>
					<select name="exp_supplier_contract_id">
						{% for contract in supplier_contracts %}
							{{input_option('exp_supplier_contract_id', contract.id, contract.name)}}
						{% endfor %}
					</select>
					<br>
					<label>Supplier Account</label>
					{{input_text('exp_supplier_account')}}
				</fieldset>
				<br>
				<input name="insert" type="submit" value="Insert">
			</fieldset>
		</form>
	{% endif %}
{% endblock %}
