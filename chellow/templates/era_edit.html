{% extends "base.html" %}

{% block title %}
	Supplies &gt; {{era.supply.id}} &gt; Era {{era.start_date|hh_format}} Edit
{% endblock %}

{% block style %}
	<style>
		label.aligned {
			width: 18em;
			float: left;
		}
	</style>
{% endblock %}

{% block nav %}
	<a href="{{context_path}}/supplies">Supplies</a> &gt;
	<a href="{{context_path}}/supplies/{{era.supply.id}}">{{era.supply.id}}</a>
 	&gt; Era {{era.start_date|hh_format}} Edit
{% endblock %}

{% block content %}
	{% if request.method == 'GET' and request.values.delete %}
		<form method="post" action="">
			<fieldset>
				<legend>
					Are you sure you want to delete this era?
				</legend>
				<input type="hidden" name="era_id" value="{{era.id}}">
				<input type="submit" name="delete" value="Delete">
			</fieldset>
		</form>
		<p>
			<a href="">Cancel</a>
		</p>
	{% else %}
		<table>
			<caption>Sites</caption>
			<thead>
				<tr>
					<th>Code</th>
					<th>Name</th>
					{% if site_eras|length > 1 %}
						<th></th>
						<th></th>
						<th></th>
					{% endif %}
				</tr>
			</thead>
			<tbody>
				{% for site_era in site_eras %}
					<tr>
						<td>
							{{site_era.site.code}}
						</td>
						<td>
							{{site_era.site.name}}
						</td>
						{% if site_eras|length > 1 %}
							<td>
								{% if site_era.is_physical %}
									Located here
								{% else %}
									<form method="post" action="">
										<fieldset>
											<input type="hidden" name="era_id" value="{{era.id}}">
											<input type="hidden" name="site_id" value="{{site_era.site.id}}">
											<input type="submit" name="locate" value="Locate Here">
										</fieldset>
									</form>
								{% endif %}
							</td>
							<td>
								<form method="post" action="">
									<fieldset>
										<legend>Detach from site</legend>
										<input type="hidden" name="era_id" value="{{era.id}}">
										<input type="hidden" name="site_id" value="{{site_era.site.id}}">
										<input type="submit" name="detach" value="Detach">
									</fieldset>
								</form>
							</td>
						{% endif %}
					</tr>
				{% endfor %}
			</tbody>
		</table>
	 
		<br>
		<form method="post" action="">
			<fieldset>
				<legend>Attach to another site</legend>
				<input type="hidden" name="era_id" value="{{era.id}}">
				<label>Site Code {{input_text("site_code", '')}}</label>
				<input type="submit" name="attach" value="Attach">
			</fieldset>
		</form>
		<br>
		<form action="" method="post">
			<fieldset>
				<input type="hidden" name="era_id" value="{{era.id}}">
				<legend>Update this era</legend>
				<fieldset>
					<legend>Start date</legend>
					{{input_date('start', era.start_date)}}
				</fieldset>
				<br>

				<fieldset>
					<legend>End Date</legend>
					<label>Ended?
					{{input_checkbox('is_ended', era.finish_date is not none)}}
					</label>
					{{input_date('finish', era.finish_date)}}
				</fieldset>

				<br>
				<br>
				<label class="aligned">MOP Contract</label>
				<select name="mop_contract_id">
					{% for contract in mop_contracts %}
						{{input_option('mop_contract_id', contract.id, contract.name, era.mop_contract.id)}}
					{% endfor %}
				</select>
				<br>
				<label class="aligned">MOP Account</label>
				{{input_text('mop_account', era.mop_account)}}
				<br>
				<label class="aligned">HHDC Contract</label>
				<select name="hhdc_contract_id">
					{% for contract in hhdc_contracts %}
						{{input_option('hhdc_contract_id', contract.id, contract.name, era.hhdc_contract.id)}}
					{% endfor %}
				</select>

				<br>
				<label class="aligned">HHDC Account</label>
				{{input_text('hhdc_account', era.hhdc_account)}}
				<br>
				<label class="aligned">Meter Serial Number</label>
				{{input_text('msn', era.msn)}}
				<br>
				<label class="aligned">Profile Class</label>
				<select name="pc_id">
					{% for pc in pcs %}
						{{input_option('pc_id', pc.id, pc.code + ' - ' + pc.name, era.pc.id)}}
					{% endfor %}
				</select>
				<br>
				<label class="aligned">Meter Timeswitch Class</label>
				{{input_text('mtc_code', era.mtc.code, 3, 3)}}
				<br />
				<label class="aligned">CoP</label>
				<select name="cop_id">
					{% for cop in cops %}
						{{input_option('cop_id', cop.id, cop.code + ' ' + cop.description, era.cop.id)}}
					{% endfor %}
				</select>
				<br>
				<label class="aligned">SSC</label>
				{{input_text('ssc_code', era.ssc.code, 4, 4)}}
				<br>
				<br>
			 
				<fieldset>
					<legend>Import MPAN</legend>
					<br>
					<label class="aligned">Line Loss Factor Class</label>
					{{input_text('imp_llfc_code', era.imp_llfc.code, 3,3)}}
					<br>
					<label class="aligned">MPAN Core</label>
					{{input_text('imp_mpan_core', era.imp_mpan_core|default(''), 16)}}
					<br>
					<label class="aligned">Agreed Supply Capacity (kVA)</label>
					{{input_text('imp_sc', era.imp_sc, 9, 9)}}
					<br>
					<label class="aligned">Supplier Contract</label>
					<select name="imp_supplier_contract_id">
						{% for contract in supplier_contracts %}
							{{input_option('imp_supplier_contract_id', contract.id, contract.name, era.imp_supplier_contract.id)}}
						{% endfor %}
					</select>
					<br>
					<label class="aligned">Supplier Account</label>
					{{input_text('imp_supplier_account', era.imp_supplier_account)}}
					<br>
				</fieldset>
				<br>
				<fieldset>
					<legend>Export MPAN</legend>
					<br>
					<label class="aligned">Line Loss Factor Class</label>
					{{input_text('exp_llfc_code', era.exp_llfc.code, 3, 3)}}
					<br>
					<label class="aligned">MPAN Core</label>
					{{input_text('exp_mpan_core', era.exp_mpan_core, 16)}}
					<br>
					<label class="aligned">Agreed Supply Capacity (kVA)</label>
					{{input_text('exp_sc', era.exp_sc, 9, 9)}}
					<br>
					<label class="aligned">Supplier Contract</label>
						<select name="exp_supplier_contract_id">
						{% for contract in supplier_contracts %}
							{{input_option('exp_supplier_contract_id', contract.id, contract.name, era.exp_supplier_contract.id)}}
						{% endfor %}
					</select>
					<br>
					<label class="aligned">Supplier Account</label>
					{{input_text('exp_supplier_account', era.supplier_account)}}
					<br>
				</fieldset>
				<br>
				<input type="submit" value="Update">

			</fieldset>
		</form>
		<br>
		{% if era.supply.eras|length > 1 %}
			<form action=".">
				<fieldset>
					<legend>Delete this era</legend>
					<input type="hidden" name="era_id" value="{{era.id}}">
					<input type="submit" name="delete" value="Delete">
				</fieldset>
			</form>
		{% endif %}
	 
	{% endif %}
{% endblock %}
